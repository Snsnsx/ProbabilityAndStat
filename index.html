<!DOCTYPE html>

<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>–ü—Ä–æ–≤–µ—Ä–æ—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Äî –û–ø—Ç–∏–∫–∞</title>
<link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@400;700;900&family=Onest:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0e1a;
    --surface: #111827;
    --surface2: #1a2236;
    --accent: #3b82f6;
    --accent2: #60a5fa;
    --danger: #ef4444;
    --success: #22c55e;
    --warning: #f59e0b;
    --text: #f0f4ff;
    --muted: #8b9cc8;
    --border: rgba(59,130,246,0.2);
    --glow: 0 0 30px rgba(59,130,246,0.15);
  }
  * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
  html,body {
    min-height:100vh; background:var(--bg);
    font-family:'Onest',sans-serif; color:var(--text);
    overscroll-behavior:none;
  }

/* –§–æ–Ω–æ–≤—ã–π —É–∑–æ—Ä */
body::before {
content:‚Äô‚Äô; position:fixed; inset:0; pointer-events:none; z-index:0;
background:
radial-gradient(ellipse 80% 60% at 10% 20%, rgba(59,130,246,0.08) 0%, transparent 60%),
radial-gradient(ellipse 60% 40% at 90% 80%, rgba(96,165,250,0.06) 0%, transparent 60%),
repeating-linear-gradient(0deg, transparent, transparent 60px, rgba(59,130,246,0.03) 60px, rgba(59,130,246,0.03) 61px),
repeating-linear-gradient(90deg, transparent, transparent 60px, rgba(59,130,246,0.03) 60px, rgba(59,130,246,0.03) 61px);
}

.screen { position:relative; z-index:1; min-height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:24px 16px; }

/* ===== –≠–ö–†–ê–ù –í–•–û–î–ê ===== */
#login-screen .card {
background:var(‚Äìsurface);
border:1px solid var(‚Äìborder);
border-radius:24px;
padding:40px 32px;
width:100%; max-width:420px;
box-shadow:var(‚Äìglow);
animation:fadeSlide .5s ease;
}
@keyframes fadeSlide { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:translateY(0)} }

.logo-icon {
width:56px; height:56px; margin:0 auto 20px;
background:linear-gradient(135deg,#1d4ed8,#3b82f6);
border-radius:16px; display:flex; align-items:center; justify-content:center;
font-size:28px; box-shadow:0 8px 24px rgba(59,130,246,0.35);
}
h1.title { font-family:‚ÄòUnbounded‚Äô,sans-serif; font-size:clamp(18px,4vw,22px); font-weight:900; text-align:center; line-height:1.3; margin-bottom:8px; }
.subtitle { color:var(‚Äìmuted); font-size:13px; text-align:center; margin-bottom:32px; font-weight:300; }

label { display:block; font-size:12px; font-weight:600; color:var(‚Äìmuted); letter-spacing:.08em; text-transform:uppercase; margin-bottom:6px; margin-top:18px; }
input[type=text], input[type=number] {
width:100%; padding:14px 16px;
background:var(‚Äìsurface2); border:1px solid var(‚Äìborder);
border-radius:12px; color:var(‚Äìtext); font-size:16px; font-family:‚ÄòOnest‚Äô,sans-serif;
outline:none; transition:.2s;
-webkit-user-select:auto !important; user-select:auto !important;
}
input[type=text]:focus, input[type=number]:focus { border-color:var(‚Äìaccent); box-shadow:0 0 0 3px rgba(59,130,246,0.15); }

.btn {
width:100%; padding:16px; margin-top:28px;
background:linear-gradient(135deg,#1d4ed8,#3b82f6);
border:none; border-radius:12px; color:#fff;
font-family:‚ÄòUnbounded‚Äô,sans-serif; font-size:14px; font-weight:700;
cursor:pointer; letter-spacing:.05em;
transition:.2s; box-shadow:0 8px 24px rgba(59,130,246,0.3);
}
.btn:hover { transform:translateY(-2px); box-shadow:0 12px 32px rgba(59,130,246,0.4); }
.btn:active { transform:translateY(0); }
.btn:disabled { opacity:.5; cursor:not-allowed; transform:none; }

/* ===== –≠–ö–†–ê–ù –¢–ï–°–¢–ê ===== */
#quiz-screen { justify-content:flex-start; padding-top:0; }

.top-bar {
position:sticky; top:0; z-index:100; width:100%;
background:rgba(10,14,26,0.92);
backdrop-filter:blur(12px);
-webkit-backdrop-filter:blur(12px);
border-bottom:1px solid var(‚Äìborder);
padding:12px 16px;
display:flex; align-items:center; justify-content:space-between; gap:12px;
}
.student-name { font-size:13px; color:var(‚Äìmuted); font-weight:500; flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.student-name span { color:var(‚Äìtext); font-weight:600; }

.timer-wrap { display:flex; align-items:center; gap:8px; }
.timer-icon { font-size:16px; }
#timer {
font-family:‚ÄòUnbounded‚Äô,sans-serif; font-size:18px; font-weight:700;
color:var(‚Äìaccent2); min-width:60px; text-align:right;
transition:.3s;
}
#timer.warning { color:var(‚Äìwarning); animation:pulse 1s infinite; }
#timer.danger { color:var(‚Äìdanger); animation:pulse .5s infinite; }
@keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.4} }

.quiz-body { width:100%; max-width:600px; padding:24px 16px 40px; }

.progress-wrap { margin-bottom:28px; }
.progress-label { font-size:12px; color:var(‚Äìmuted); margin-bottom:8px; display:flex; justify-content:space-between; }
.progress-bar { height:4px; background:var(‚Äìsurface2); border-radius:4px; overflow:hidden; }
.progress-fill { height:100%; border-radius:4px; background:linear-gradient(90deg,#1d4ed8,#60a5fa); transition:.5s; }

.question-card {
background:var(‚Äìsurface); border:1px solid var(‚Äìborder);
border-radius:20px; padding:28px 24px; margin-bottom:20px;
animation:fadeSlide .35s ease;
position:relative; overflow:hidden;
}
.question-card::before {
content:‚Äô‚Äô; position:absolute; top:0; left:0; right:0; height:3px;
background:linear-gradient(90deg,#1d4ed8,#60a5fa);
}
.q-num {
font-family:‚ÄòUnbounded‚Äô,sans-serif; font-size:11px; font-weight:700;
color:var(‚Äìaccent); letter-spacing:.1em; text-transform:uppercase; margin-bottom:16px;
display:inline-flex; align-items:center; gap:6px;
}
.q-num::after { content:‚Äô‚Äô; display:block; width:24px; height:2px; background:var(‚Äìaccent); border-radius:2px; }
.q-text { font-size:15px; line-height:1.7; color:var(‚Äìtext); margin-bottom:8px; font-weight:400; }
.q-formula {
background:var(‚Äìsurface2); border-radius:10px; padding:12px 16px;
margin:12px 0; font-family:monospace; font-size:14px; color:var(‚Äìaccent2);
border-left:3px solid var(‚Äìaccent);
}
.q-ask { font-size:15px; font-weight:600; color:var(‚Äìtext); margin-top:12px; }

.answer-wrap { margin-top:16px; display:flex; align-items:center; gap:10px; }
.answer-wrap input[type=number] { flex:1; }
.answer-status { font-size:20px; width:28px; text-align:center; }

/* ===== SUBMIT ===== */
.submit-btn {
width:100%; padding:18px;
background:linear-gradient(135deg,#065f46,#10b981);
border:none; border-radius:14px; color:#fff;
font-family:‚ÄòUnbounded‚Äô,sans-serif; font-size:14px; font-weight:700;
cursor:pointer; letter-spacing:.05em; margin-top:8px;
box-shadow:0 8px 24px rgba(16,185,129,0.3);
transition:.2s;
}
.submit-btn:hover { transform:translateY(-2px); box-shadow:0 12px 32px rgba(16,185,129,0.4); }
.submit-btn:disabled { opacity:.5; cursor:not-allowed; transform:none; }

/* ===== –ë–ê–ù–ù–ï–† –ó–ê–ú–ï–ß–ê–ù–ò–Ø ===== */
#warning-banner {
display:none; position:fixed; inset:0; z-index:9999;
background:rgba(10,14,26,0.97);
flex-direction:column; align-items:center; justify-content:center;
padding:32px; text-align:center;
animation:fadeIn .3s;
}
@keyframes fadeIn { from{opacity:0} to{opacity:1} }
#warning-banner.active { display:flex; }
.warn-icon { font-size:64px; margin-bottom:24px; animation:shake .5s; }
@keyframes shake { 0%,100%{transform:rotate(0)} 25%{transform:rotate(-10deg)} 75%{transform:rotate(10deg)} }
#warning-banner h2 { font-family:‚ÄòUnbounded‚Äô,sans-serif; font-size:clamp(20px,5vw,28px); font-weight:900; color:var(‚Äìdanger); margin-bottom:12px; }
#warning-banner p { color:var(‚Äìmuted); font-size:15px; max-width:320px; line-height:1.6; margin-bottom:28px; }
#warn-count { display:inline-block; background:rgba(239,68,68,0.15); border:1px solid rgba(239,68,68,0.3); border-radius:8px; padding:6px 14px; font-size:13px; color:var(‚Äìdanger); margin-bottom:28px; font-weight:600; }
.warn-close { padding:14px 32px; background:var(‚Äìdanger); border:none; border-radius:12px; color:#fff; font-family:‚ÄòUnbounded‚Äô,sans-serif; font-size:13px; font-weight:700; cursor:pointer; letter-spacing:.05em; transition:.2s; }
.warn-close:hover { background:#dc2626; }

/* ===== –≠–ö–†–ê–ù –†–ï–ó–£–õ–¨–¢–ê–¢–ê ===== */
#result-screen .card { background:var(‚Äìsurface); border:1px solid var(‚Äìborder); border-radius:24px; padding:40px 32px; width:100%; max-width:420px; text-align:center; animation:fadeSlide .5s ease; }
.result-icon { font-size:64px; margin-bottom:20px; }
.result-title { font-family:‚ÄòUnbounded‚Äô,sans-serif; font-size:clamp(20px,5vw,26px); font-weight:900; margin-bottom:8px; }
.result-sub { color:var(‚Äìmuted); font-size:14px; margin-bottom:24px; line-height:1.6; }
.result-score { font-family:‚ÄòUnbounded‚Äô,sans-serif; font-size:56px; font-weight:900; color:var(‚Äìaccent); margin:16px 0; }
.result-detail { background:var(‚Äìsurface2); border-radius:12px; padding:16px; text-align:left; margin-top:16px; }
.result-row { display:flex; justify-content:space-between; align-items:center; padding:8px 0; border-bottom:1px solid var(‚Äìborder); font-size:14px; }
.result-row:last-child { border-bottom:none; }
.result-row .ok { color:var(‚Äìsuccess); font-weight:700; }
.result-row .err { color:var(‚Äìdanger); font-weight:700; }
.sending-msg { color:var(‚Äìmuted); font-size:13px; margin-top:16px; }

/* –°–ø–∏–Ω–Ω–µ—Ä */
.spinner { display:inline-block; width:16px; height:16px; border:2px solid var(‚Äìborder); border-top-color:var(‚Äìaccent); border-radius:50%; animation:spin .8s linear infinite; vertical-align:middle; margin-right:6px; }
@keyframes spin { to{transform:rotate(360deg)} }

@media(max-width:380px) {
.question-card { padding:20px 16px; }
.q-text, .q-ask { font-size:14px; }
}
</style>

</head>
<body>

<!-- ===== –≠–ö–†–ê–ù –í–•–û–î–ê ===== -->

<div class="screen" id="login-screen">
  <div class="card">
    <div class="logo-icon">üî≠</div>
    <h1 class="title">–ü—Ä–æ–≤–µ—Ä–æ—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞</h1>
    <p class="subtitle">–§–∏–∑–∏–∫–∞ ¬∑ –û–ø—Ç–∏–∫–∞ ¬∑ 20 –º–∏–Ω—É—Ç</p>
    <label for="last-name">–§–∞–º–∏–ª–∏—è</label>
    <input type="text" id="last-name" placeholder="–ò–≤–∞–Ω–æ–≤" autocomplete="off" autocorrect="off" autocapitalize="words">
    <label for="first-name">–ò–º—è</label>
    <input type="text" id="first-name" placeholder="–ò–≤–∞–Ω" autocomplete="off" autocorrect="off" autocapitalize="words">
    <button class="btn" id="start-btn" onclick="startQuiz()">–ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É ‚Üí</button>
  </div>
</div>

<!-- ===== –≠–ö–†–ê–ù –¢–ï–°–¢–ê ===== -->

<div class="screen" id="quiz-screen" style="display:none;">
  <div class="top-bar" style="align-self:stretch;">
    <div class="student-name">–£—á–µ–Ω–∏–∫: <span id="name-display"></span></div>
    <div class="timer-wrap">
      <span class="timer-icon">‚è±</span>
      <div id="timer">20:00</div>
    </div>
  </div>
  <div class="quiz-body" id="quiz-body">
    <div class="progress-wrap">
      <div class="progress-label"><span>–ü—Ä–æ–≥—Ä–µ—Å—Å</span><span id="prog-text">0 / 4</span></div>
      <div class="progress-bar"><div class="progress-fill" id="prog-fill" style="width:0%"></div></div>
    </div>

```
<!-- –ó–∞–¥–∞–Ω–∏–µ 1 -->
<div class="question-card">
  <div class="q-num">–ó–∞–¥–∞–Ω–∏–µ 1</div>
  <div class="q-text">–§–æ–∫—É—Å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –ª–∏–Ω–∑—ã <b>F = 2</b>. –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç –ª–∏–Ω–∑—ã –¥–æ –ø—Ä–µ–¥–º–µ—Ç–∞ <b>d = 4</b>.</div>
  <div class="q-formula">h' = 5/16</div>
  <div class="q-ask">–ö–∞–∫–æ–π –≤—ã—Å–æ—Ç—ã –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–µ–¥–º–µ—Ç, —á—Ç–æ–±—ã –µ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–º–µ–ª–æ –≤—ã—Å–æ—Ç—É 5/16?</div>
  <div class="answer-wrap">
    <input type="number" id="ans1" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç" step="any" oninput="updateProgress()">
    <span class="answer-status" id="st1"></span>
  </div>
</div>

<!-- –ó–∞–¥–∞–Ω–∏–µ 2 -->
<div class="question-card">
  <div class="q-num">–ó–∞–¥–∞–Ω–∏–µ 2</div>
  <div class="q-text">–§–æ–∫—É—Å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –ª–∏–Ω–∑—ã <b>F = 4</b>. –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç –ª–∏–Ω–∑—ã –¥–æ –ø—Ä–µ–¥–º–µ—Ç–∞ <b>d = 8</b>.</div>
  <div class="q-formula">h' = 7/64</div>
  <div class="q-ask">–ö–∞–∫–æ–π –≤—ã—Å–æ—Ç—ã –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–µ–¥–º–µ—Ç, —á—Ç–æ–±—ã –µ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–º–µ–ª–æ –≤—ã—Å–æ—Ç—É 7/64?</div>
  <div class="answer-wrap">
    <input type="number" id="ans2" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç" step="any" oninput="updateProgress()">
    <span class="answer-status" id="st2"></span>
  </div>
</div>

<!-- –ó–∞–¥–∞–Ω–∏–µ 3 -->
<div class="question-card">
  <div class="q-num">–ó–∞–¥–∞–Ω–∏–µ 3</div>
  <div class="q-text">–§–æ–∫—É—Å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –ª–∏–Ω–∑—ã <b>F = ‚àí5</b>. –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç –ª–∏–Ω–∑—ã –¥–æ –ø—Ä–µ–¥–º–µ—Ç–∞ <b>d = 10</b>.</div>
  <div class="q-formula">h' = 2/100</div>
  <div class="q-ask">–ö–∞–∫–æ–π –≤—ã—Å–æ—Ç—ã –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–µ–¥–º–µ—Ç, —á—Ç–æ–±—ã –µ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–º–µ–ª–æ –≤—ã—Å–æ—Ç—É 2/100?</div>
  <div class="answer-wrap">
    <input type="number" id="ans3" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç" step="any" oninput="updateProgress()">
    <span class="answer-status" id="st3"></span>
  </div>
</div>

<!-- –ó–∞–¥–∞–Ω–∏–µ 4 -->
<div class="question-card">
  <div class="q-num">–ó–∞–¥–∞–Ω–∏–µ 4</div>
  <div class="q-text">–§–æ–∫—É—Å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –ª–∏–Ω–∑—ã <b>F = ‚àí10</b>. –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç –ª–∏–Ω–∑—ã –¥–æ –ø—Ä–µ–¥–º–µ—Ç–∞ <b>d = 20</b>.</div>
  <div class="q-formula">h' = 6/40</div>
  <div class="q-ask">–ö–∞–∫–æ–π –≤—ã—Å–æ—Ç—ã –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–µ–¥–º–µ—Ç, —á—Ç–æ–±—ã –µ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–º–µ–ª–æ –≤—ã—Å–æ—Ç—É 6/40?</div>
  <div class="answer-wrap">
    <input type="number" id="ans4" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç" step="any" oninput="updateProgress()">
    <span class="answer-status" id="st4"></span>
  </div>
</div>

<button class="submit-btn" id="submit-btn" onclick="submitQuiz()">–°–¥–∞—Ç—å —Ä–∞–±–æ—Ç—É ‚úì</button>
```

  </div>
</div>

<!-- ===== –ë–ê–ù–ù–ï–† –ó–ê–ú–ï–ß–ê–ù–ò–Ø ===== -->

<div id="warning-banner">
  <div class="warn-icon">‚ö†Ô∏è</div>
  <h2>–ù–∞—Ä—É—à–µ–Ω–∏–µ!</h2>
  <p>–í—ã –ø–æ–∫–∏–Ω—É–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–æ –≤—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–æ—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã. –≠—Ç–æ –∑–∞–º–µ—á–∞–Ω–∏–µ –±—É–¥–µ—Ç –∑–∞–ø–∏—Å–∞–Ω–æ.</p>
  <div id="warn-count">–ó–∞–º–µ—á–∞–Ω–∏–µ ‚Ññ1</div>
  <button class="warn-close" onclick="closeWarning()">–ü–æ–Ω—è–ª(–∞), –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ä–∞–±–æ—Ç–µ</button>
</div>

<!-- ===== –≠–ö–†–ê–ù –†–ï–ó–£–õ–¨–¢–ê–¢–ê ===== -->

<div class="screen" id="result-screen" style="display:none;">
  <div class="card">
    <div class="result-icon" id="res-icon">üéâ</div>
    <div class="result-title" id="res-title">–†–∞–±–æ—Ç–∞ —Å–¥–∞–Ω–∞!</div>
    <div class="result-sub" id="res-sub"></div>
    <div class="result-score" id="res-score"></div>
    <div class="result-detail" id="res-detail"></div>
    <p class="sending-msg" id="sending-msg"><span class="spinner"></span>–û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤‚Ä¶</p>
  </div>
</div>

<script>
// ===== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø =====
const CORRECT_ANSWERS = [5, 7, 2, 60];
const TOTAL_TIME = 20 * 60; // —Å–µ–∫—É–Ω–¥—ã
// üîß –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –í–ê–® URL Apps Script:
const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzUv4o2JBIn2bj0tgR11de2lruFWuXlSeBonYucj-BJEXGp-ibQ1jZAQ_CxCEQIv4lK/exec';

// ===== –°–û–°–¢–û–Ø–ù–ò–ï =====
let studentName = '';
let timerInterval = null;
let timeLeft = TOTAL_TIME;
let quizStarted = false;
let quizFinished = false;
let warningCount = 0;
let violations = [];

// ===== –ó–ê–ü–†–ï–¢ –ö–û–ü–ò–†–û–í–ê–ù–ò–Ø =====
document.addEventListener('copy', e => { if (quizStarted && !quizFinished) { e.preventDefault(); } });
document.addEventListener('cut', e => { if (quizStarted && !quizFinished) e.preventDefault(); });
document.addEventListener('contextmenu', e => { if (quizStarted && !quizFinished) e.preventDefault(); });
document.addEventListener('keydown', e => {
  if (!quizStarted || quizFinished) return;
  // –ó–∞–ø—Ä–µ—Ç PrintScreen
  if (e.key === 'PrintScreen' || e.key === 'F12') { e.preventDefault(); showWarning('screenshot'); return false; }
  // –ó–∞–ø—Ä–µ—Ç Ctrl+C, Ctrl+A –Ω–∞ —Ç–µ–∫—Å—Ç–µ –∑–∞–¥–∞—á
  if (e.ctrlKey && (e.key==='c'||e.key==='C'||e.key==='a'||e.key==='A'||e.key==='p'||e.key==='P'||e.key==='s'||e.key==='S')) {
    const t = e.target;
    if (t.tagName!=='INPUT') { e.preventDefault(); }
  }
});

// –ó–∞–ø—Ä–µ—Ç —Å–∫—Ä–∏–Ω iOS (—Å–ª–∞–±—ã–π, –Ω–æ –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–∏–≥–Ω–∞–ª)
window.addEventListener('blur', () => {
  if (quizStarted && !quizFinished) showWarning('tab-switch');
});
document.addEventListener('visibilitychange', () => {
  if (quizStarted && !quizFinished && document.hidden) showWarning('tab-hidden');
});

// –ó–∞–ø—Ä–µ—Ç –ø–æ–∫–∏–¥–∞–Ω–∏—è (beforeunload)
window.addEventListener('beforeunload', e => {
  if (quizStarted && !quizFinished) {
    e.preventDefault();
    e.returnValue = '–†–∞–±–æ—Ç–∞ –µ—â—ë –Ω–µ —Å–¥–∞–Ω–∞!';
    return e.returnValue;
  }
});

// ===== –õ–û–ì–ò–ö–ê =====
function startQuiz() {
  const ln = document.getElementById('last-name').value.trim();
  const fn = document.getElementById('first-name').value.trim();
  if (!ln || !fn) { alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é –∏ –∏–º—è.'); return; }
  studentName = ln + ' ' + fn;
  document.getElementById('name-display').textContent = studentName;
  document.getElementById('login-screen').style.display = 'none';
  document.getElementById('quiz-screen').style.display = 'flex';
  quizStarted = true;
  startTimer();
}

function startTimer() {
  const el = document.getElementById('timer');
  timerInterval = setInterval(() => {
    timeLeft--;
    const m = Math.floor(timeLeft/60).toString().padStart(2,'0');
    const s = (timeLeft%60).toString().padStart(2,'0');
    el.textContent = m+':'+s;
    if (timeLeft <= 60) { el.className = 'danger'; }
    else if (timeLeft <= 300) { el.className = 'warning'; }
    if (timeLeft <= 0) { clearInterval(timerInterval); submitQuiz(true); }
  }, 1000);
}

function updateProgress() {
  let filled = 0;
  for (let i=1;i<=4;i++) {
    const v = document.getElementById('ans'+i).value;
    if (v !== '') filled++;
  }
  document.getElementById('prog-fill').style.width = (filled/4*100)+'%';
  document.getElementById('prog-text').textContent = filled+' / 4';
}

function showWarning(reason) {
  warningCount++;
  const ts = new Date().toLocaleTimeString('ru-RU');
  violations.push({reason, time: ts, count: warningCount});
  document.getElementById('warn-count').textContent = '–ó–∞–º–µ—á–∞–Ω–∏–µ ‚Ññ'+warningCount;
  document.getElementById('warning-banner').classList.add('active');
}

function closeWarning() {
  document.getElementById('warning-banner').classList.remove('active');
  window.focus();
}

function submitQuiz(auto=false) {
  if (quizFinished) return;
  if (!auto) {
    const filled = [1,2,3,4].filter(i => document.getElementById('ans'+i).value!=='').length;
    if (filled < 4) {
      if (!confirm('–í—ã –æ—Ç–≤–µ—Ç–∏–ª–∏ –Ω–µ –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã. –í—Å—ë —Ä–∞–≤–Ω–æ —Å–¥–∞—Ç—å —Ä–∞–±–æ—Ç—É?')) return;
    }
  }
  quizFinished = true;
  clearInterval(timerInterval);
  const btn = document.getElementById('submit-btn');
  if (btn) btn.disabled = true;

  const answers = CORRECT_ANSWERS.map((correct, i) => {
    const val = parseFloat(document.getElementById('ans'+(i+1)).value);
    return { num: i+1, given: isNaN(val) ? null : val, correct, ok: val===correct };
  });

  const score = answers.filter(a=>a.ok).length;
  showResult(answers, score, auto);
  sendResults(answers, score, auto);
}

function showResult(answers, score, auto) {
  document.getElementById('quiz-screen').style.display = 'none';
  document.getElementById('result-screen').style.display = 'flex';

  const icons = ['üòî','üòê','üòä','üéØ','üèÜ'];
  document.getElementById('res-icon').textContent = icons[score];
  document.getElementById('res-title').textContent = auto ? '–í—Ä–µ–º—è –∏—Å—Ç–µ–∫–ª–æ!' : '–†–∞–±–æ—Ç–∞ —Å–¥–∞–Ω–∞!';
  document.getElementById('res-sub').textContent = studentName + ' ¬∑ –ù–∞—Ä—É—à–µ–Ω–∏–π: ' + warningCount;
  document.getElementById('res-score').textContent = score + '/4';

  const detail = document.getElementById('res-detail');
  detail.innerHTML = answers.map(a => `
    <div class="result-row">
      <span>–ó–∞–¥–∞–Ω–∏–µ ${a.num}</span>
      <span>–í–∞—à –æ—Ç–≤–µ—Ç: ${a.given ?? '‚Äî'}</span>
      <span class="${a.ok?'ok':'err'}">${a.ok?'‚úì':'‚úó'}</span>
    </div>
  `).join('');
}

function sendResults(answers, score, timeUp) {
  const payload = {
    timestamp: new Date().toISOString(),
    student: studentName,
    score: score + '/4',
    timeSpent: Math.floor((TOTAL_TIME - timeLeft) / 60) + ' –º–∏–Ω ' + ((TOTAL_TIME - timeLeft) % 60) + ' —Å–µ–∫',
    timeUp: timeUp ? '–î–∞' : '–ù–µ—Ç',
    violations: warningCount,
    ans1: document.getElementById('ans1').value || '‚Äî',
    ans2: document.getElementById('ans2').value || '‚Äî',
    ans3: document.getElementById('ans3').value || '‚Äî',
    ans4: document.getElementById('ans4').value || '‚Äî',
    ok1: answers[0].ok ? '‚úì' : '‚úó',
    ok2: answers[1].ok ? '‚úì' : '‚úó',
    ok3: answers[2].ok ? '‚úì' : '‚úó',
    ok4: answers[3].ok ? '‚úì' : '‚úó',
  };

  fetch(APPS_SCRIPT_URL, {
    method: 'POST',
    mode: 'no-cors',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify(payload)
  }).then(() => {
    document.getElementById('sending-msg').innerHTML = '‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã —É—á–∏—Ç–µ–ª—é';
  }).catch(() => {
    document.getElementById('sending-msg').innerHTML = '‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å ‚Äî –ø–æ–∫–∞–∂–∏—Ç–µ —É—á–∏—Ç–µ–ª—é —ç–∫—Ä–∞–Ω';
  });
}

// –ó–∞–ø—Ä–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –≤ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö –∑–∞–¥–∞—á
document.querySelectorAll('.q-text, .q-formula, .q-ask, .q-num').forEach(el => {
  el.style.userSelect = 'none';
  el.style.webkitUserSelect = 'none';
});
</script>

</body>
</html>
